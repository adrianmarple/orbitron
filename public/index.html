<!DOCTYPE html>
<html>
<head>
<title>Super Orbitron</title>
<link rel="shortcut icon" href="/favicon.png" />

<style type="text/css">
html, body, #main {
  margin: 0;
  width: 100%;
  height: 100%;
}
#main {
  display: flex;
  flex-direction: column;
  align-items: center;
  font-size: 3em;
  font-family: Arial;
  padding-top: 8vh;
  box-sizing: border-box;
  background: url("logoMonochromeAlpha.png");
  background-repeat: no-repeat;
  background-position: bottom 10% right 50%;
  background-size: auto 50vh;
}


@keyframes animatedBackground {
  from { background-position: 0 0; }
  to { background-position: 100% 0; }
}
#background {
  position: fixed;
  left: -150vh;
  top: -200vw;
  z-index: -1;
  width: 400vh;
  height: 500vw;
  background: url("greydient.png");
  -webkit-transform: rotate(60deg);
  -moz-transform: rotate(60deg);
  -ms-transform: rotate(60deg);
  -o-transform: rotate(60deg);
  transform: rotate(60deg);
  background-size: 20% 100%;
  animation: animatedBackground 100s linear infinite;
  opacity: 0.5;
}

.wifi-icon {
  width: 20%;
}
.wifi-icon.e-show path {
  fill: red;
}

.e-show {
  display: none;
}
.error .e-show {
  display: initial;
}

.e-hide {
  display: initial;
}
.error .e-hide {
  display: none;
}

.bang {
  color: white;
  background: #121212;
  padding: 12px;
  border-radius: 50%;
  font-size: 3em;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 128px;
  height: 128px;
  margin-top: 24px;
}

.button {
  background: white;
  border-radius: 12px;
  padding: 24px;
  margin-top: 24px;
  cursor: pointer;
  font-weight: bold;
  box-shadow: 0 0.4rem 1rem 0.25rem rgba(0, 0, 0, 0.5);
}
</style>
</head>
<body>
<div id="background"></div>
<div id="main">
  <!-- <div class="e-show"><div class="bang">!</div></div> -->
  <svg class="wifi-icon e-hide" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 24 24"><path d="M12,21L15.6,16.2C14.6,15.45 13.35,15 12,15C10.65,15 9.4,15.45 8.4,16.2L12,21M12,3C7.95,3 4.21,4.34 1.2,6.6L3,9C5.5,7.12 8.62,6 12,6C15.38,6 18.5,7.12 21,9L22.8,6.6C19.79,4.34 16.05,3 12,3M12,9C9.3,9 6.81,9.89 4.8,11.4L6.6,13.8C8.1,12.67 9.97,12 12,12C14.03,12 15.9,12.67 17.4,13.8L19.2,11.4C17.19,9.89 14.7,9 12,9Z"/></svg>
  <svg class="wifi-icon e-show" viewBox="0 0 24 24">
    <path fill="currentColor" d="M20.24 5H18V7.25C16.16 6.45 14.13 6 12 6C8.62 6 5.5 7.12 3 9L1.2 6.6C4.21 4.34 7.95 3 12 3C14.97 3 17.77 3.73 20.24 5M8.4 16.2L12 21L15.6 16.2C14.6 15.45 13.35 15 12 15S9.4 15.45 8.4 16.2M4.8 11.4L6.6 13.8C8.1 12.67 9.97 12 12 12S15.9 12.67 17.4 13.8L18 13V10.62C16.23 9.59 14.19 9 12 9C9.3 9 6.81 9.89 4.8 11.4M20 17H22V15H20V17M20 7V13H22V7H20Z" />
  </svg>

  <div class="e-show">Something went wrong</div>
  <br class="e-show"/>
  <div>Make sure you're on wifi</div>
  <div>"Super Orbitron"</div>

  <br/>
  <div class="e-hide button" onclick="checkConnection()">Connect to the Orbitron</div>
  <div class="e-show button" onclick="checkConnection()">Try connecting again</div>

  <div id="logo" src="/logoMonochromeAlpha.png" />
</div>


<script>
let ip = "192.168.1.101"
let name = location.pathname
if (name == '/') {
  name = "default"
}
console.log(name)
const xhttp = new XMLHttpRequest()
xhttp.onreadystatechange = function() {
  if (this.readyState == 4 && this.status == 200 && xhttp.responseText) {
    const response = JSON.parse(xhttp.responseText)
    console.log(response)
    if (response) {
      ip = response
    }
  }
}
xhttp.open("GET", `https://super-orbitron-default-rtdb.firebaseio.com/ips/${name}.json`, true)
xhttp.send()


function checkConnection() {
  console.log("Checking connection")
  let newWindow = open(`http://${ip}:1337`)

  setTimeout(() => {
    try {
      newWindow.location.href
      newWindow.close()
      document.getElementById("main").classList.add("error")
    } catch(e) {
      // Error means cross domain access was attempted and page is loading properly.
      close()
    }
  }, 500)
}

</script>
</body>
</html>
